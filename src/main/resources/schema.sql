DROP TABLE IF EXISTS likes CASCADE;
DROP TABLE IF EXISTS film_genres CASCADE;
DROP TABLE IF EXISTS films CASCADE;
DROP TABLE IF EXISTS user_friends CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS mpa CASCADE;
DROP TABLE IF EXISTS genres CASCADE;



CREATE TABLE IF NOT EXISTS genres (
	genre_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	genre_name VARCHAR(14) NOT NULL,
	CONSTRAINT genres_pk PRIMARY KEY (genre_id)
);

CREATE TABLE IF NOT EXISTS mpa (
	mpa_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	mpa_name VARCHAR(5) NOT NULL,
	CONSTRAINT mpa_pk PRIMARY KEY (mpa_id)
);

CREATE TABLE IF NOT EXISTS users (
	user_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	email VARCHAR NOT NULL,
	login VARCHAR(255) NOT NULL,
	user_name VARCHAR(255),
	birthday DATE,
	CONSTRAINT users_pk PRIMARY KEY (user_id)
);

CREATE TABLE IF NOT EXISTS user_friends (
	user_id BIGINT NOT NULL,
	friend_id BIGINT NOT NULL,
	UNIQUE (user_id, friend_id),
	CONSTRAINT user_friends_pk PRIMARY KEY (user_id, friend_id),
	CONSTRAINT user_friends_fk FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE IF NOT EXISTS films (
	film_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	film_name VARCHAR(255) NOT NULL,
	description VARCHAR(200),
	release_date DATE,
	duration INTEGER,
	mpa_id BIGINT NOT NULL,
	CONSTRAINT films_pk PRIMARY KEY (film_id),
	CONSTRAINT films_fk FOREIGN KEY (mpa_id) REFERENCES mpa(mpa_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS film_genres (
	film_id BIGINT REFERENCES films(film_id) ON DELETE CASCADE,
	genre_id BIGINT REFERENCES genres(genre_id) ON DELETE CASCADE,
	CONSTRAINT FILM_GENRES_PK PRIMARY KEY (FILM_ID,GENRE_ID),
	CONSTRAINT film_genres_fk FOREIGN KEY (film_id) REFERENCES films(film_id),
	CONSTRAINT film_genres_fk_1 FOREIGN KEY (genre_id) REFERENCES genres(genre_id)
);

CREATE TABLE IF NOT EXISTS likes (
    film_id BIGINT REFERENCES films(film_id) ON DELETE CASCADE,
	user_id BIGINT REFERENCES users(user_id) ON DELETE CASCADE,
	UNIQUE (film_id, user_id)
);